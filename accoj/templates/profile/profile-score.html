{% extends 'profile/profile-base.html' %}
{% block page_title %}我的成绩{% endblock %}
{% block page_title_li %}我的成绩{% endblock %}
{% block content %}
    <div class="animated fadeIn">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <strong class="card-title">我的成绩</strong>
                    </div>
                    <div class="card-body" style="height: 60%;width: 60%">
                        <canvas id="myChart" width="600" height="400"></canvas>
                        <hr/>
                        <canvas id="pie-chart" width="600" height="600"></canvas>
                        <script type="application/javascript">
                            function getRandomInt(min, max) {
                                min = Math.ceil(min);
                                max = Math.floor(max);
                                return Math.floor(Math.random() * (max - min)) + min; //The maximum is exclusive and the minimum is inclusive
                            }

                            let dateArray = [100, 95, 85, 70, 66, 90, 50, 30, 90, 50],
                                sum = dateArray.reduce((a, b) => a + b),
                                backgroundColor = Array(),
                                c1 = 'rgba(255, 99, 132, 0.6)',
                                c2 = 'rgba(153, 102, 255, 0.6)',
                                c3 = 'rgba(54, 162, 235, 0.6)',
                                c4 = 'rgba(75, 192, 192, 0.6)',
                                c5 = 'rgba(255, 206, 86, 0.6)',
                                c6 = 'rgba(231, 76, 60, 0.6)';
                            dateArray.forEach(function (value) {
                                if (value === 100) backgroundColor.push(c1);
                                else if (value >= 90) backgroundColor.push(c2);
                                else if (value >= 80) backgroundColor.push(c3);
                                else if (value >= 70) backgroundColor.push(c4);
                                else if (value >= 60) backgroundColor.push(c5);
                                else backgroundColor.push(c6);
                            });
                            let options = {
                                responsive: true,
                                title: {
                                    display: true,
                                    text: '总得分: ' + sum + ' / 1000'
                                },
                                legend: {
                                    display: true,
                                    position: 'left',
                                    labels: {
                                        boxWidth: 80,
                                        fontColor: 'rgb(60, 180, 100)'
                                    }
                                },
                                scales: {
                                    yAxes: [{
                                        ticks: {
                                            beginAtZero: true
                                        }
                                    }]
                                }
                            };
                            // Get the context of the canvas element we want to select
                            let ctx = document.getElementById("myChart").getContext("2d");
                            let data = {
                                labels: ["I", "II", "III", "IV", "V", "VI", "VII", "VIII", "IX", "X"],
                                datasets: [{
                                    label: '分数',
                                    data: dateArray,
                                    backgroundColor: backgroundColor
                                }]
                            };
                            new Chart(ctx, {
                                type: 'bar',
                                data: data,
                                options: options
                            });
                            //------------------------------------------------------------------
                            c1 = 'rgba(255,0,0,0.6)';
                            c2 = 'rgba(255,127,0,0.6)';
                            c3 = 'rgba(255,212,0,0.6)';
                            c4 = 'rgba(255,255,0,0.6)';
                            c5 = 'rgba(191,255,0,0.6)';
                            c6 = 'rgba(106,255,0,0.6)';
                            let c7 = 'rgba(0,234,255,0.6)',
                                c8 = 'rgba(0,149,255,0.6)',
                                c9 = 'rgba(0,64,255,0.6)',
                                c10 = 'rgba(170,0,255,0.6)',
                                c11 = 'rgba(255,0,170,0.6)';

                            dateArray.forEach(function (value, index) {
                                dateArray[index] = getRandomInt(0, 10);
                            });
                            dateArray.push(10);
                            backgroundColor = [c1, c2, c3, c4, c5, c6, c7, c8, c9, c10, c11];
                            let labels = ["0~99", "100~199", "200~299", "300~399", "400~499", "500~599", "600~699", "700~799", "800~899", "900~999", '1000'],
                                data1 = {
                                    labels: labels,
                                    datasets: [{
                                        data: dateArray,
                                        backgroundColor: backgroundColor,
                                        borderColor: "#fff"
                                    }]
                                };
                            sum = dateArray.reduce((a, b) => a + b);
                            let options1 = {
                                responsive: false,
                                title: {
                                    display: true,
                                    text: ['得分区间统计', '', '总人数：' + sum]
                                },
                                tooltips: {
                                    enabled: true,
                                    callbacks: {
                                        label: function (tooltipItem) {
                                            let index = tooltipItem.index,
                                                label_t = labels[index],
                                                num = dateArray[index];
                                            return [label_t, '人数：' + num]
                                        }
                                    }
                                },
                                plugins: {
                                    datalabels: {
                                        formatter: (value, ctx) => {
                                            let sum = 0;
                                            let dataArr = ctx.chart.data.datasets[0].data;
                                            dataArr.map(data => {
                                                sum += data;
                                            });
                                            let percentTag = (value * 100 / sum).toFixed(2) + "%";
                                            return percentTag
                                        },
                                        color: '#000000',
                                    }
                                },
                                legend: {
                                    display: true,
                                    position: 'left'
                                }
                            };

                            let ctx1 = document.getElementById("pie-chart").getContext('2d');
                            new Chart(ctx1, {
                                type: 'pie',
                                data: data1,
                                options: options1
                            });
                        </script>
                    </div>
                </div>
            </div>


        </div>
    </div><!-- .animated -->
    <!-- Scripts -->

    <script src="{{ url_for('static', filename='assets/js/lib/data-table/datatables.min.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/lib/data-table/dataTables.bootstrap.min.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/lib/data-table/dataTables.buttons.min.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/lib/data-table/buttons.bootstrap.min.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/lib/data-table/jszip.min.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/lib/data-table/vfs_fonts.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/lib/data-table/buttons.html5.min.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/lib/data-table/buttons.print.min.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/lib/data-table/buttons.colVis.min.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/init/datatables-init.js') }}"></script>


    <script type="text/javascript">
        $(document).ready(function () {
            $('#bootstrap-data-table-export').DataTable();
        });
    </script>
{% endblock %}
